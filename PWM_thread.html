<!DOCTYPE html>
<HTML>
<head>
<title>GPIO_Thread:PWM</title>
<META NAME="AUTHOR" CONTENT="Jamie Boyd">
</head>
<H2>PWM Thread</H2>
<p> The relevant files are:
<ul><li>PWM_thread.cpp/h -- C++ class subclassed from pulsedThread to feed data to the PWM peripheral</li>
<li>PWM_sin_thread.cpp/h -- C++ class subclassed from PWM_thread to output a sine wave with changable frequency</li>
<li>PWM_thread_test.cpp -- C++ application using PWM_thread and PWM_sin_thread to do hardware pulse width modulation</li>
<li>PWM_thread_Py.cpp -- C++ code for a Python module, ptPWM, to make and use PWM_thread and PWM_sin_thread from Python</li>
<li>PWM_thread_setup.py -- Python code to make and install the ptPWM Python library</li>
<li>PTPWM.py -- Python code that wraps the ptPWM module in a Python object interface</li>
<li>PTPWM_test.py -- Python code with tests for PTPWM. May require speakers, oscilloscope, LED</li></ul>
</p>
<h3>The Pulse Width Modulation (PWM)Peripheral</h3>
<p>The PWM peripheral outputs a square wave with a duty cycle set by its input.  Once configured, the output is continuously cycled with no CPU involvement. The time period of each cycle is set by the PWM range (how many clock ticks there are in one cycle), and the PWM clock rate (the number of clock ticks per second).  The PWM range sets the precision of the PWMM output; the PWM input is an integer, and the ratio of this input to the PWM range sets the duty cycle of the output. The refresh time of the PWM output is thus the the PWM range / PWM clock rate.
</p>
<h3>PWM Range and Frequency and Clock Configuration </h3>
<p>The clock source for the PWM peripheral is The Audio clocks run from the peripherals clock sources and use clock generators with noise- shaping MASH dividers. MASH noise-shaping is incorporated to push the fractional divider jitter out of the audio band if required. The MASH can be programmed for 1, 2 or 3-stage filtering. It is beyond the scope of this specification to describe the operation of a MASH filter or 
to determine under what conditions the available levels of filtering are beneficial. Fractional divider jitter is reduced by increasing the input frequency to the clock generators
therefore the fastest clock available should be supplied to the audio clock generators when jitter 
is a concern.
The PWM frequency is 1/(time taken to output a single value) which is determined by range and PWM clock frequency. The PWM range is the number of clock ticks needed to output a single value, i.e., the number of bits in the inputs. This PWM frequency is only accurate for the given PWMrange The two PWM channels could use different ranges, and thus have different PWM frequencies even though they use the same PWM clock. We don't do that here; we always use the same range for both channels.
	Returns the actual PWM frequency, else returns -1 if the requested PWMFreq, PWMrange combination requires too high a clock speed or -2 if the requested PWMFreq, PWMrange combination combination requires too low a clock speed Call this function before configuring any channels, because it zeros the PWM_CTL register, losing any channel configuration information
</p>
<hr>
<a href = "./GPIO_Thread.html">Back to GPIO Thread index</a>
</body>
</html>